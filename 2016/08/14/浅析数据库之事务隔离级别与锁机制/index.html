<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.useso.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Mysql," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="浅析数据库之事务隔离级别与锁机制写在前面，写这篇博文的主要原因是因为前几天阿里面试的时候，面试官问了数据库的事务隔离级别，虽然答上来了:未提交读(Read uncommitted)、提交读(Read committed)，可重复读(Repeatable reads)和可串行化(Serializable)这几个，其实当时是想深入的讲解一下，因为之前看沈询前辈的海量数据系列博文的时候，讲到的数据库的隔">
<meta property="og:type" content="article">
<meta property="og:title" content="浅析数据库之事务隔离级别与锁机制">
<meta property="og:url" content="http://xianyijun.github.io/2016/08/14/浅析数据库之事务隔离级别与锁机制/index.html">
<meta property="og:site_name" content="枯叶未凋零">
<meta property="og:description" content="浅析数据库之事务隔离级别与锁机制写在前面，写这篇博文的主要原因是因为前几天阿里面试的时候，面试官问了数据库的事务隔离级别，虽然答上来了:未提交读(Read uncommitted)、提交读(Read committed)，可重复读(Repeatable reads)和可串行化(Serializable)这几个，其实当时是想深入的讲解一下，因为之前看沈询前辈的海量数据系列博文的时候，讲到的数据库的隔">
<meta property="og:updated_time" content="2016-08-14T17:20:20.229Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浅析数据库之事务隔离级别与锁机制">
<meta name="twitter:description" content="浅析数据库之事务隔离级别与锁机制写在前面，写这篇博文的主要原因是因为前几天阿里面试的时候，面试官问了数据库的事务隔离级别，虽然答上来了:未提交读(Read uncommitted)、提交读(Read committed)，可重复读(Repeatable reads)和可串行化(Serializable)这几个，其实当时是想深入的讲解一下，因为之前看沈询前辈的海量数据系列博文的时候，讲到的数据库的隔">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 浅析数据库之事务隔离级别与锁机制 | 枯叶未凋零 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d7a77056cb6c66982de5797b0470724d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">枯叶未凋零</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">高山仰止，景行行止，虽不能至，心向往之</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                浅析数据库之事务隔离级别与锁机制
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-14T17:12:39+08:00" content="2016-08-14">
              2016-08-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/14/浅析数据库之事务隔离级别与锁机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/14/浅析数据库之事务隔离级别与锁机制/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="浅析数据库之事务隔离级别与锁机制"><a href="#浅析数据库之事务隔离级别与锁机制" class="headerlink" title="浅析数据库之事务隔离级别与锁机制"></a><strong>浅析数据库之事务隔离级别与锁机制</strong></h1><p>写在前面，写这篇博文的主要原因是因为前几天阿里面试的时候，面试官问了数据库的事务隔离级别，虽然答上来了:未提交读(Read uncommitted)、提交读(Read committed)，可重复读(Repeatable reads)和可串行化(Serializable)这几个，其实当时是想深入的讲解一下，因为之前看沈询前辈的海量数据系列博文的时候，讲到的数据库的隔离级别是通过数据库锁机制来实现的，不过当时记的不太清楚，担心把自己挖坑给埋了，就没有深入回答，现在就趁着是周日，把知识点复习一遍，把知识网络理清楚。</p>
<h2 id="二阶段封锁"><a href="#二阶段封锁" class="headerlink" title="二阶段封锁"></a><strong>二阶段封锁</strong></h2><p>在并发环境下，我们往往需要进行并发控制，如果不进行并发控制的话，数据会出现一系列的问题：脏读，不可重复读和幻读。<br>然后数据库在事务执行过程中，需要维护事务的ACID特性，往往需要通过加锁来进行控制。<br>在高并发的情况之下，使用锁的话，如果加锁过度，可能会导致并发的性能降低，为了提供共享资源的并发性，往往要让锁定的对象具有选择性，即尽量只锁定要修改部分的数据资源，而不是所有的资源。<br>一般情况下，我们可以通过一次封锁法来对资源进行锁定，即就是在方法执行开始阶段，通过知道需要使用哪些数据资源，就将对应的资源进行锁定，减少锁的粗粒度，在执行方法完成之后，在进行解锁，避免了死锁的发生。<br>然而在数据库事务中，这却是不可行，因为在事务执行的时候，我们不清楚我们需要对哪些资源进行操作。<br>数据库事务是使用二阶段协议（2PL）来完成的，把事务分为两个阶段：加锁阶段和解锁阶段。</p>
<ul>
<li><p>加锁阶段：在该阶段，我们可以进行加锁操作，在对数据进行读操作的时候，我们需要申请并获得读锁(s锁，共享锁，在事务获得锁的情况下，其他事务也可以加锁，但是不可以加排他锁)；如果要进行写操作的话，则需要申请和获得写锁（x锁，排他锁，在有事务获得写锁的情况下，其他事务不能获的其他锁，包括读锁），如果在申请期间，事务没有获得锁，则事务就会进入等待阶段，直到加锁的成功才会继续进行。</p>
</li>
<li><p>解锁阶段　 当事务释放一个封锁之后，事务就不能够获得其他封锁了，只能进行解锁操作而不能进行加锁操作。</p>
</li>
</ul>
<p>在事务开启后，执行update、insert、delete操作会获得对应的锁，在事务commit之后就会释放对应的锁。<br>二阶段封锁虽然无法避免封锁，但是它可以保证事务的并发调度是串行化的。</p>
<h2 id="事务加锁机制"><a href="#事务加锁机制" class="headerlink" title="事务加锁机制"></a><strong>事务加锁机制</strong></h2><h3 id="数据库锁分类"><a href="#数据库锁分类" class="headerlink" title="数据库锁分类"></a><strong>数据库锁分类</strong></h3><p>MySQL中锁的种类很多，比较常见的有表锁和行锁。<br>表锁即锁住整张表，虽然也分为读锁和写锁，但是锁住了整张表，并发性能也会导致降低，一般用在ddl处理时候进行使用。<br>行锁是指锁住数据行，它只会锁住对应的数据行，也不会锁住整张表，并行性能比较高，ＭySQL一般使用表锁来处理并发事务。</p>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a><strong>事务隔离级别</strong></h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读（Dirty Read）</th>
<th>不可重复读（NonRepeatable Read）</th>
<th>幻读（Phantom Read）</th>
</tr>
</thead>
<tbody>
<tr>
<td>未提交读（Read uncommitted）</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>已提交读（Read committed）</td>
<td>不可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>可重复读（Repeatable read）</td>
<td>不可能</td>
<td>不可能</td>
<td>可能</td>
</tr>
<tr>
<td>可串行化（Serializable ）</td>
<td>不可能</td>
<td>不可能</td>
<td>不可能</td>
</tr>
</tbody>
</table>
<p>数据库操作中，使用事务隔离级别来保证并发读取数据的正确性。</p>
<ul>
<li><p>未提交读：　允许脏读，就是可以读取其他会话中未提交事务修改的数据。</p>
</li>
<li><p>已提交读：　只能读取已经提交的数据，清除了脏读问题。</p>
</li>
<li><p>可重复读：　在同一个事务内的进行的查询都与事务开始时刻一致，它是Innodb的默认级别，它清除了不可重复读，但是还是存在幻象读。</p>
</li>
<li><p>可串行化：　完全串行话的读，每次读取的时候都需要重新获取表级共享锁，读写相互都会发生阻塞。</p>
</li>
</ul>
<h3 id="未提交读"><a href="#未提交读" class="headerlink" title="未提交读"></a><strong>未提交读</strong></h3><p>未提交读隔离级别，任何操作都不会加锁，一般都不会使用。</p>
<h3 id="已提交读"><a href="#已提交读" class="headerlink" title="已提交读"></a><strong>已提交读</strong></h3><p>在已提交读级别中，对于update、insert、delete操作进行的所加的锁会一直持续到事务结束才释放，而对于select操作所加的锁则是在select操作完成之后就会进行释放，不会持续到事务结束才释放。因此它能避免读取在事务中间没有提交的数据，它能保证读取到读取的数据都是已提交的，避免了脏读，但是它不能保证在事务中两次读取的结果集一致。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">session</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> committed;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">SESSION</span> binlog_format = <span class="string">'ROW'</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>事务Ａ</th>
<th>事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td>set autocommit = 0</td>
<td>set autocommit = 0</td>
</tr>
<tr>
<td>update user set education=’暨南大学’ where userId=30000;</td>
</tr>
<tr>
<td></td>
<td>update user set education=’暨南大学’ where userId=30000; </td>
</tr>
<tr>
<td></td>
<td>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>
</tr>
<tr>
<td>commit</td>
</tr>
</tbody>
</table>
<p>为了防止并发过程中发生修改冲突，在事务A中对userId=30000的数据行进行加锁，如果一直不进行commit的话，事务B一直在申请得不到锁，会一直等待超时。<br>不过这处需要注意，因为userId是索引列，在进行加锁的只是对索引列值为30000的数据行进行加锁，而不会对其他数据行进行加锁，但是如果要加锁的数据列是没有索引的话，他会对所有的数据行进行加锁，因为在执行SQL的时候，数据库并不知道哪些数据行对应的数据行是需要进行加锁的，因为如果where条件无法通过索引进行快速过滤的话，存储引擎会将所有的记录加锁之后返回，然后再在服务层进行过滤。(Innodb只有在访问数据行的时候才会进行加锁，索引能够减少Innodb访问的行数，从而减少锁的数量，但这是只有Innodb能够在存储引擎层能够过滤掉所有不需要的行的时候才有效，如果索引无法过滤掉无效的行的话，只有Innodb访问数据行检索到数据并返回到服务层的时候，where子句才有进行过滤)<br>不过实际上，MySQL5.1版本之后在这进行了优化，Innodb可以在服务层过滤掉数据行，对这些过滤掉的数据行进行释放锁，不需要等到事务提交之后才释放锁。</p>
<h3 id="可重复读"><a href="#可重复读" class="headerlink" title="可重复读"></a><strong>可重复读</strong></h3><p>可重复读的事务隔离级别是Innodb的默认隔离级别。可重复度事务隔离级别对于select所加的读锁和insert、update、delete操作所加的写锁都会一直持续到事务结束才会进行释放。</p>
<h4 id="读"><a href="#读" class="headerlink" title="读"></a><strong>读</strong></h4><p>读即是可重复读，即在一个事务中对同一个查询进行多次读取，能够看到同样的数据行。</p>
<table>
<thead>
<tr>
<th>事务Ａ</th>
<th>事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td>set autocommit = 0</td>
<td>set autocommit = 0</td>
</tr>
<tr>
<td>select * from user where userId=30000</td>
</tr>
<tr>
<td></td>
<td>update user set education=’暨南大学’ where userId=30000; </td>
</tr>
<tr>
<td></td>
<td>commit</td>
</tr>
<tr>
<td>select * from user where userId=30000</td>
</tr>
<tr>
<td>commit</td>
</tr>
</tbody>
</table>
<p>如果在读已提交事务隔离级别的情况下，在这事务A的两次查询当中，两次查询得到的结果集是不相同的，即不可重复读的。</p>
<p>如果在可重复读的隔离级别下：</p>
<table>
<thead>
<tr>
<th>事务Ａ</th>
<th>事务B</th>
<th>事务C</th>
</tr>
</thead>
<tbody>
<tr>
<td>set autocommit = 0</td>
<td>set autocommit = 0</td>
<td>set autocommit = 0</td>
</tr>
<tr>
<td>select * from user where roleId=300</td>
</tr>
<tr>
<td></td>
<td>update user set education=’暨南大学’ where roleId=300;</td>
</tr>
<tr>
<td></td>
<td>commit</td>
</tr>
<tr>
<td></td>
<td></td>
<td>insert into user values(null,”西安大学”,300)</td>
</tr>
<tr>
<td></td>
<td></td>
<td>commit</td>
</tr>
<tr>
<td>select * from user where roleId=300</td>
<td></td>
</tr>
<tr>
<td>commit</td>
</tr>
</tbody>
</table>
<p>在这并发事务中，我们可以看到事务A先进行了一次读取，在事务B中进行了一次数据的修改，在事务C中进行了一次数据的插入，不过在事务A中第二次读取得到的数据与第一次完全相同，即它是可以进行重读的。<br>不过在这里我们首先需要对幻读和不可重复读这两种并发导致的问题进行区分</p>
<h4 id="幻读与不可重复读"><a href="#幻读与不可重复读" class="headerlink" title="幻读与不可重复读"></a><strong>幻读与不可重复读</strong></h4><p>不可重复读主要是针对与delete和update操作来讲的，而幻读主要是针对insert操作来讲的，即不可重复读是针对数据库中已有的数据，而幻读是对原不在数据库中的数据来讲的。<br>如果是使用锁机制来实现这两种隔离级别的话（可串行化和可重复读）的话。在重复读中，查询语句在第一次读取数据后，就会对读取的数据进行加锁，那么其他事务就无法对加锁的数据进行修改，就可以实现重复读取，但是这些的话无法对insert进来新的数据进行加锁，这样的话，在事务A读取数据或者修改数据之后，事务B还是可以进行insert操作的,这样的话，在事务A就会发现多了一条新的记录，即出现了幻读，不可以通过行锁来避免，这需要可串行化隔离级别，读用读锁，写用写锁，读写互斥，而且在读取数据的时候会有获取一个范围锁（range-locks），保证读取的范围加锁，新的满足满足条件的记录不能插入（间隙锁），来避免幻读。<br>不过以上讲的是使用悲观锁机制来处理这两种问题，不过在MySQL中，都是使用以乐观锁为理论基础的MVCC（多版本并发控制）来避免问题。</p>
<h4 id="悲观锁与乐观锁"><a href="#悲观锁与乐观锁" class="headerlink" title="悲观锁与乐观锁"></a><strong>悲观锁与乐观锁</strong></h4><ul>
<li>悲观锁　</li>
</ul>
<p>悲观锁是指数据对外部环境（本系统当前的其他事务或者其他外部系统的事务处理）保持保守悲观态度，即在整个数据处理的过程中，将数据处于锁定状态，其他事务无法进行修改。悲观锁的实现，往往是依靠数据库提供的锁机制(只有通过数据库层面才能保证数据访问的排他性)来实现的。<br>在悲观锁的情况下，为了保证事务的隔离性，通过一致性锁进行读写锁定，在读取数据的时候进行加锁，其他事务无法修改这些数据。 在修改删除数据时候也要加锁，其他事务无法读取数据。</p>
<ul>
<li>乐观锁　<br>乐观锁相对于悲观锁而已，乐观锁机制采取比较宽松的加锁机制，悲观锁是通过依靠数据库的锁机制实现的，认为在大部分情况存在着并发访问，需要加锁来保证操作的独占性。而乐观锁则认为在大部分情况下是不存在并发访问的，不需要加锁来保证数据的独占性，而是通过数据版本（Version）记录机制来为数据作一个版本标识，即在基于数据库表的版本解决方案则是通过在数据库表增加一个version字段来实现，在进行数据读取的时候，将版本号进行一同读取，在对数据进行更新的时候，对版本号进行加一操作，同时，在提交的时候会对提交数据的版本号与数据库表对应记录的当前版本号进行对比，如果当前提交数据的版本对在数据库表中记录的版本号大的话，就进行更新，否则就认为是过期数据。</li>
</ul>
<h4 id="Innodb中的乐观锁实现（MVCC）"><a href="#Innodb中的乐观锁实现（MVCC）" class="headerlink" title="Innodb中的乐观锁实现（MVCC）"></a><strong>Innodb中的乐观锁实现（MVCC）</strong></h4><h4 id="当前读和快照读"><a href="#当前读和快照读" class="headerlink" title="当前读和快照读"></a><strong>当前读和快照读</strong></h4><h3 id="可串行化"><a href="#可串行化" class="headerlink" title="可串行化"></a><strong>可串行化</strong></h3>
      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Mysql/" rel="tag">#Mysql</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/11/操作系统之内存管理/" rel="next" title="操作系统之内存管理">
                <i class="fa fa-chevron-left"></i> 操作系统之内存管理
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/14/浅析数据库之事务隔离级别与锁机制/"
           data-title="浅析数据库之事务隔离级别与锁机制" data-url="http://xianyijun.github.io/2016/08/14/浅析数据库之事务隔离级别与锁机制/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="枯叶未凋零" />
          <p class="site-author-name" itemprop="name">枯叶未凋零</p>
          <p class="site-description motion-element" itemprop="description">高山仰止，景行行止，虽不能至，心向往之</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xianyijun" target="_blank" title="github">
                  
                    <i class="fa fa-globe"></i>
                  
                  github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/xianyijun" target="_blank" title="weibo">
                  
                    <i class="fa fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa fa-globe fa-fw"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://jm.taobao.org/" title="阿里中间件团队博客" target="_blank">阿里中间件团队博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.zhangxinxu.com/" title="张鑫旭" target="_blank">张鑫旭</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://my.oschina.net/huangyong/" title="黄勇" target="_blank">黄勇</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://rednaxelafx.iteye.com/" title="RednaxelaFX" target="_blank">RednaxelaFX</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://jinnianshilongnian.iteye.com/" title="开涛" target="_blank">开涛</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://huangz.me/" title="黄健宏" target="_blank">黄健宏</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.sina.com.cn/hailiangshuju" title="淘宝沈询" target="_blank">淘宝沈询</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#浅析数据库之事务隔离级别与锁机制"><span class="nav-number">1.</span> <span class="nav-text">浅析数据库之事务隔离级别与锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#二阶段封锁"><span class="nav-number">1.1.</span> <span class="nav-text">二阶段封锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务加锁机制"><span class="nav-number">1.2.</span> <span class="nav-text">事务加锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库锁分类"><span class="nav-number">1.2.1.</span> <span class="nav-text">数据库锁分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务隔离级别"><span class="nav-number">1.2.2.</span> <span class="nav-text">事务隔离级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#未提交读"><span class="nav-number">1.2.3.</span> <span class="nav-text">未提交读</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#已提交读"><span class="nav-number">1.2.4.</span> <span class="nav-text">已提交读</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可重复读"><span class="nav-number">1.2.5.</span> <span class="nav-text">可重复读</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#读"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#幻读与不可重复读"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">幻读与不可重复读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#悲观锁与乐观锁"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">悲观锁与乐观锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Innodb中的乐观锁实现（MVCC）"><span class="nav-number">1.2.5.4.</span> <span class="nav-text">Innodb中的乐观锁实现（MVCC）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#当前读和快照读"><span class="nav-number">1.2.5.5.</span> <span class="nav-text">当前读和快照读</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可串行化"><span class="nav-number">1.2.6.</span> <span class="nav-text">可串行化</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">冼毅俊</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
<div style="text-align:center;width:100%;height:50">
备案信息:粤IC备16069701
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"xianyijun"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
