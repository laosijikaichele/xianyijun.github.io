
<!DOCTYPE html>
<html lang="zh-Hans">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="枯叶未凋零">
    <title>枯叶未凋零</title>
    <meta name="author" content="冼毅俊">
    
    
    
    <meta name="description" content="枯叶未凋零的个人博客，记录，积累，分享">
<meta property="og:type" content="blog">
<meta property="og:title" content="枯叶未凋零">
<meta property="og:url" content="http://xianyijun.github.io/page/29/index.html">
<meta property="og:site_name" content="枯叶未凋零">
<meta property="og:description" content="枯叶未凋零的个人博客，记录，积累，分享">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="枯叶未凋零">
<meta name="twitter:description" content="枯叶未凋零的个人博客，记录，积累，分享">
    
    
        
    
    
        <meta property="og:image" content="http://xianyijun.github.io/assets/images/avatar_01.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox-thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    
    <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d7a77056cb6c66982de5797b0470724d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">枯叶未凋零</a>
    </h1>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="#search">
        
        
            <i class="fa fa-lg fa-search"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar_01.jpg"/>
            </a>
            <span class="sidebar-profile-name">冼毅俊</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-circle-thin"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bars"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-terminal"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/xianyijun" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/link"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-at"></i>
                    <span class="sidebar-button-desc">Links</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/05/07/Netty源码分析之编码与解码/">
                            Netty源码分析之编码与解码
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Sat May 07 2016 20:50:58 GMT+0800">
	
		    May 07, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Netty源码分析之编码与解码"><a href="#Netty源码分析之编码与解码" class="headerlink" title="Netty源码分析之编码与解码"></a><strong>Netty源码分析之编码与解码</strong></h1><h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a><strong>解码</strong></h2><h3 id="ByteToMessageDecoder"><a href="#ByteToMessageDecoder" class="headerlink" title="ByteToMessageDecoder"></a><strong>ByteToMessageDecoder</strong></h3><p>在进行网络编程的时候，我们往往需要将读取到的字节数组或者缓冲区数组转化为对应业务逻辑的POJO对象。Netty为我们提供ByteToMessageDecoder抽象工具类将ByteBuf转为POJO对象，我们只需要继续ByteToMessageDecoder抽象类，实现decode方法就可以了。不过ByteToMessageDecoder没有提供半包或者组包的处理，需要我们自己去实现。<br>decode方法在channelRead方法中被调用，我们先来看一下channelRead方法。<br>channelRead方法首先对要解码的消息msg进行类型判断，如果msg是ByteBuf对象的话，才需要转码，否则进行直接透传；<br>然后通过对cumulation是否为null进行判断，如果为null，说明这是第一次解码或者上一次解码结束，没有缓存的半包消息需要进行处理，直接把data赋值给cumulation；否则不为null的话，说明cumulation缓存中有上次还没有完全解码的ByteBuf，需要进行复制操作，将要解码的ByteBuf复制到cumulation中。<br>在进行复制的时候，需要对cumulation的可读缓冲区进行判断，如果不足的话需要进行扩展，扩展需要利用字节缓冲区分配器ByteBufAllocator重新分配一个缓冲区，将cumulation复制到新的缓冲区，然后释放cumulation；在复制完成之后对需要解码的缓冲区进行释放，调用callDecode进行解码.<br>在callDecode中对ByteBuf进行循环解码，只要ByteBuf还有可读的字节，在循环中调用decode方法进行解码，是由具体子类进行实现的。在解码完成之后会对pipeLine的状态和解码结果进行判断；如果ChannelHandlerContext被移除了，就不能继续进行解码，退出循环；如果输出的out列表长度没有变化说明没有解码成功，对ByteBuf的readableBytes进行比较，如果不等说明对消息进行消费，进行循环，否则的话说明消息是半包消息，需要继续接收消息，退出循环。如果解码出一个或多个消息，却没有消费消息，抛出DecoderException异常；最后对isSingleDecode进行判断，如果是单条消息解码器，第一次解码成功之后退出循环。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> ByteBuf) &#123;</span><br><span class="line">        RecyclableArrayList out = RecyclableArrayList.newInstance();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ByteBuf data = (ByteBuf) msg;</span><br><span class="line">            first = cumulation == <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (first) &#123;</span><br><span class="line">                cumulation = data;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cumulation = cumulator.cumulate(ctx.alloc(), cumulation, data);</span><br><span class="line">            &#125;</span><br><span class="line">            callDecode(ctx, cumulation, out);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DecoderException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> DecoderException(t);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cumulation != <span class="keyword">null</span> &amp;&amp; !cumulation.isReadable()) &#123;</span><br><span class="line">                numReads = <span class="number">0</span>;</span><br><span class="line">                cumulation.release();</span><br><span class="line">                cumulation = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (++ numReads &gt;= discardAfterReads) &#123;</span><br><span class="line">                numReads = <span class="number">0</span>;</span><br><span class="line">                discardSomeReadBytes();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> size = out.size();</span><br><span class="line">            decodeWasNull = !out.insertSinceRecycled();</span><br><span class="line">            fireChannelRead(ctx, out, size);</span><br><span class="line">            out.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Cumulator MERGE_CUMULATOR = <span class="keyword">new</span> Cumulator() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ByteBuf <span class="title">cumulate</span><span class="params">(ByteBufAllocator alloc, ByteBuf cumulation, ByteBuf in)</span> </span>&#123;</span><br><span class="line">        ByteBuf buffer;</span><br><span class="line">        <span class="keyword">if</span> (cumulation.writerIndex() &gt; cumulation.maxCapacity() - in.readableBytes()</span><br><span class="line">                || cumulation.refCnt() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            buffer = expandCumulation(alloc, cumulation, in.readableBytes());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            buffer = cumulation;</span><br><span class="line">        &#125;</span><br><span class="line">        buffer.writeBytes(in);</span><br><span class="line">        in.release();</span><br><span class="line">        <span class="keyword">return</span> buffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">callDecode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (in.isReadable()) &#123;</span><br><span class="line">            <span class="keyword">int</span> outSize = out.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                fireChannelRead(ctx, out, outSize);</span><br><span class="line">                out.clear();</span><br><span class="line">                <span class="keyword">if</span> (ctx.isRemoved()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                outSize = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> oldInputLength = in.readableBytes();</span><br><span class="line">            decode(ctx, in, out);</span><br><span class="line">            <span class="keyword">if</span> (ctx.isRemoved()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outSize == out.size()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (oldInputLength == in.readableBytes()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (oldInputLength == in.readableBytes()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> DecoderException(</span><br><span class="line">                        StringUtil.simpleClassName(getClass()) +</span><br><span class="line">                        <span class="string">".decode() did not read anything but decoded a message."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isSingleDecode()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (DecoderException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable cause) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> DecoderException(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="MessageToMessageDecoder"><a href="#MessageToMessageDecoder" class="headerlink" title="MessageToMessageDecoder"></a><strong>MessageToMessageDecoder</strong></h3><p>MessageToMessageDecoder是Netty的二次解码器，可以把一个POJO对象解码成另一个POJO对象。<br>MessageToMessageDecoder首先创建一个可重复回收的RecyclableArrayList，然后对msg的类型进行判断，如果是可以解析的消息的话，调用decode进行解码，由具体子类进行实现，解码完成之后对已经解码的msg进行释放。<br>如果消息的类型不可以被解码的话，就将消息添加到RecyclableArrayList不进行解码。<br>最后遍历RecyclableArrayList，调用ChannelHandlerContext.fireChannelRead,通知接下来的ChannelHandler进行处理。通知完成之后，调用RecyclableArrayList.recycle进行释放。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext. ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    RecyclableArrayList out = RecyclableArrayList.newInstance();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acceptInboundMessage(msg)) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            I cast = (I) msg;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                decode(ctx, cast, out);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                ReferenceCountUtil.release(cast);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            out.add(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (DecoderException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> DecoderException(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> size = out.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i ++) &#123;</span><br><span class="line">            ctx.fireChannelRead(out.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        out.recycle();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="LengthFieldBasedFrameDecoder"><a href="#LengthFieldBasedFrameDecoder" class="headerlink" title="LengthFieldBasedFrameDecoder"></a><strong>LengthFieldBasedFrameDecoder</strong></h3><p>LengthFieldBasedFrameDecoder主要是用来解决半包问题，要解决半包问题，我们首先需要区分一个整包消息：</p>
<ul>
<li>固定长度整包，通过每固定长度代表一个整包消息，如果不足的话，在前面填充0补全。</li>
<li>通过回车换行符区分整包。</li>
<li>通过分隔符区分整包。</li>
<li>通过指定长度来区分整包</li>
</ul>
<p>LengthFieldBasedFrameDecoder可以通过配置参数来解决不同的半包解决策略。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> lengthFieldOffset;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> lengthFieldLength;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> lengthAdjustment;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> initialBytesToStrip;</span><br></pre></td></tr></table></figure></p>
<p>decode方法首先判断需不需要丢弃当前可读的字节数。如果为真的话，需要判断要丢弃的字节数，由于丢弃的字节数不能大于可读字节数，取bytesToDiscard、readableBytes的最小值；计算完需要丢弃的字节数之后，调用ByteBuf.skip方法跳过指定的字节数，然后调用bytesToDiscard减去跳过的字节数和设置，然后failIfNecessary进行判断是否已经达到要跳过的字节数，达到的话对tooLongFrameLength进行设置。<br>然后对ByteBuf的可读字节数与长度偏移量进行比较，如果小于的话，说明当前缓冲区的数据不足，需要继续读取，返回null；然后通过readIndex和lengthFieldOffset得到实际的长度字段索引，获取消息报文的长度字段；获取到长度之后，需要对长度进行合法性校验，如果长度小于0的话，跳过lengthFieldEndOffset个字节，抛出CorruptedFrameException异常；<br>如果大于0的话，根据lengthAdjustment和lengthFieldEndOffset对长度进行修正，如果修正之后的长度小于lengthFieldEndOffset，说明数据报出错，跳过lengthFieldEndOffset个字节，抛出CorruptedFrameException异常；<br>如果修正后的长度大于maxFrameLength的话，需要设置tooLongFrameLength和计算要丢弃的字节数。<br>首先通过frameLength减去缓冲区的可读字节数，就是要丢弃的字节数，如果需要丢弃的字节数小于缓冲区可读的字节数，就直接丢弃整包消息，需要大于的话，则说明计算是丢弃整包消息也无法完成任务，需要设置discardingTooLongFrame，在下一次解码的时候继续丢弃，在丢弃完成之后，调用failIfNecessary根据情况抛出异常，返回null;<br>如果可读的消息小于frameLength，则说明是半包消息，返回null,继续读取数据:<br>然后对需要忽略的消息头字段initialBytesToStrip进行判断，如果大于frameLength的话，说明是非法数据报，抛出CorruptedFrameException异常。否则跳过忽略的消息头字段的字节数，获取整包ByteBuf；<br>然后通过ByteBuf进行extract获取解码后的整包消息缓冲区。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (discardingTooLongFrame) &#123;</span><br><span class="line">        <span class="keyword">long</span> bytesToDiscard = <span class="keyword">this</span>.bytesToDiscard;</span><br><span class="line">        <span class="keyword">int</span> localBytesToDiscard = (<span class="keyword">int</span>) Math.min(bytesToDiscard, in.readableBytes());</span><br><span class="line">        in.skipBytes(localBytesToDiscard);</span><br><span class="line">        bytesToDiscard -= localBytesToDiscard;</span><br><span class="line">        <span class="keyword">this</span>.bytesToDiscard = bytesToDiscard;</span><br><span class="line"></span><br><span class="line">        failIfNecessary(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (in.readableBytes() &lt; lengthFieldEndOffset) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> actualLengthFieldOffset = in.readerIndex() + lengthFieldOffset;</span><br><span class="line">    <span class="keyword">long</span> frameLength = getUnadjustedFrameLength(in, actualLengthFieldOffset, lengthFieldLength, byteOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (frameLength &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        in.skipBytes(lengthFieldEndOffset);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CorruptedFrameException(</span><br><span class="line">                <span class="string">"negative pre-adjustment length field: "</span> + frameLength);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    frameLength += lengthAdjustment + lengthFieldEndOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (frameLength &lt; lengthFieldEndOffset) &#123;</span><br><span class="line">        in.skipBytes(lengthFieldEndOffset);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CorruptedFrameException(</span><br><span class="line">                <span class="string">"Adjusted frame length ("</span> + frameLength + <span class="string">") is less "</span> +</span><br><span class="line">                <span class="string">"than lengthFieldEndOffset: "</span> + lengthFieldEndOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (frameLength &gt; maxFrameLength) &#123;</span><br><span class="line">        <span class="keyword">long</span> discard = frameLength - in.readableBytes();</span><br><span class="line">        tooLongFrameLength = frameLength;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (discard &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// buffer contains more bytes then the frameLength so we can discard all now</span></span><br><span class="line">            in.skipBytes((<span class="keyword">int</span>) frameLength);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Enter the discard mode and discard everything received so far.</span></span><br><span class="line">            discardingTooLongFrame = <span class="keyword">true</span>;</span><br><span class="line">            bytesToDiscard = discard;</span><br><span class="line">            in.skipBytes(in.readableBytes());</span><br><span class="line">        &#125;</span><br><span class="line">        failIfNecessary(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// never overflows because it's less than maxFrameLength</span></span><br><span class="line">    <span class="keyword">int</span> frameLengthInt = (<span class="keyword">int</span>) frameLength;</span><br><span class="line">    <span class="keyword">if</span> (in.readableBytes() &lt; frameLengthInt) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (initialBytesToStrip &gt; frameLengthInt) &#123;</span><br><span class="line">        in.skipBytes(frameLengthInt);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CorruptedFrameException(</span><br><span class="line">                <span class="string">"Adjusted frame length ("</span> + frameLength + <span class="string">") is less "</span> +</span><br><span class="line">                <span class="string">"than initialBytesToStrip: "</span> + initialBytesToStrip);</span><br><span class="line">    &#125;</span><br><span class="line">    in.skipBytes(initialBytesToStrip);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// extract frame</span></span><br><span class="line">    <span class="keyword">int</span> readerIndex = in.readerIndex();</span><br><span class="line">    <span class="keyword">int</span> actualFrameLength = frameLengthInt - initialBytesToStrip;</span><br><span class="line">    ByteBuf frame = extractFrame(ctx, in, readerIndex, actualFrameLength);</span><br><span class="line">    in.readerIndex(readerIndex + actualFrameLength);</span><br><span class="line">    <span class="keyword">return</span> frame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a><strong>编码</strong></h2><h3 id="MessageToByteEncoder"><a href="#MessageToByteEncoder" class="headerlink" title="MessageToByteEncoder"></a><strong>MessageToByteEncoder</strong></h3><p>MessageToByteEncoder可以将POJO对象编码成ByteBuf进行传输。<br>首先调用acceptOutboundMessage对要发送的消息进行判断是否支持，如果部支持的话，直接透传；<br>否则的话根据缓冲区类型直接内存分配，直接内存或者堆内存,ioBuffer或者heapBuffer。<br>内存分配完成之后，调用encode进行编码，由具体子类实现，编码完成之后进行消息释放。<br>然后对缓冲区进行判断，如果有可读字节数，则调用ChannelHandlerContext.write进行发送；否则的话释放ByteBuf，发送一个Unpooled.EMPTY_BUFFER;<br>在发送完成之后，对缓冲区进行释放。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ByteBuf buf = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acceptOutboundMessage(msg)) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            I cast = (I) msg;</span><br><span class="line">            buf = allocateBuffer(ctx, cast, preferDirect);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                encode(ctx, cast, buf);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                ReferenceCountUtil.release(cast);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (buf.isReadable()) &#123;</span><br><span class="line">                ctx.write(buf, promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                buf.release();</span><br><span class="line">                ctx.write(Unpooled.EMPTY_BUFFER, promise);</span><br><span class="line">            &#125;</span><br><span class="line">            buf = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.write(msg, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (EncoderException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> EncoderException(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (buf != <span class="keyword">null</span>) &#123;</span><br><span class="line">            buf.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="MessageToMessageEncoder"><a href="#MessageToMessageEncoder" class="headerlink" title="MessageToMessageEncoder"></a><strong>MessageToMessageEncoder</strong></h3><p>MessageToMessageEncoder可以将一个POJO对象编码成另一个对象。<br>首先创建一个可重复利用的RecyclableArrayList，然后对需要编码的对象进行判断，看是否能进行编码，如果不可以的话，直接透传，进入下一次ChannelHandler；如果可以的话，调用encode方法进行编码，具体由子类进行实现；在完成编码之后，如果RecyclableArrayList为空，说明编码没有成功，需要释放RecyclableArrayList，抛出EncoderException异常。<br>如果编码成功的话，循环cyclableArrayList，调用ChannelHandlerContext发送编码之后的POJO对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    RecyclableArrayList out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acceptOutboundMessage(msg)) &#123;</span><br><span class="line">            out = RecyclableArrayList.newInstance();</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            I cast = (I) msg;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                encode(ctx, cast, out);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                ReferenceCountUtil.release(cast);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (out.isEmpty()) &#123;</span><br><span class="line">                out.recycle();</span><br><span class="line">                out = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EncoderException(</span><br><span class="line">                        StringUtil.simpleClassName(<span class="keyword">this</span>) + <span class="string">" must produce at least one message."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.write(msg, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (EncoderException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> EncoderException(t);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> sizeMinusOne = out.size() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (sizeMinusOne == <span class="number">0</span>) &#123;</span><br><span class="line">                ctx.write(out.get(<span class="number">0</span>), promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sizeMinusOne &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// Check if we can use a voidPromise for our extra writes to reduce GC-Pressure</span></span><br><span class="line">                <span class="comment">// See https://github.com/netty/netty/issues/2525</span></span><br><span class="line">                ChannelPromise voidPromise = ctx.voidPromise();</span><br><span class="line">                <span class="keyword">boolean</span> isVoidPromise = promise == voidPromise;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sizeMinusOne; i ++) &#123;</span><br><span class="line">                    ChannelPromise p;</span><br><span class="line">                    <span class="keyword">if</span> (isVoidPromise) &#123;</span><br><span class="line">                        p = voidPromise;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        p = ctx.newPromise();</span><br><span class="line">                    &#125;</span><br><span class="line">                    ctx.write(out.get(i), p);</span><br><span class="line">                &#125;</span><br><span class="line">                ctx.write(out.get(sizeMinusOne), promise);</span><br><span class="line">            &#125;</span><br><span class="line">            out.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="LengthFieldPrepender"><a href="#LengthFieldPrepender" class="headerlink" title="LengthFieldPrepender"></a><strong>LengthFieldPrepender</strong></h4><p>LengthFieldPrepender是MessageToMessageEncoder的实现类，实现了encode方法，可以在待发送的ByteBuf消息头中增加一个长度长度来标志消息的长度。<br>encode方法首先对长度进行设置，length等消息msg的可读字节数加上lengthAdjustment;如果长度包含长度消息长度本身，需要在原来length的基础上增加lengthFieldLength；<br>如果修改之后的length小于0，则抛出IllegalArgumentException异常；<br>否则的话对消息长度自身所占的字节数进行判断和校验，如果校验通过的话，将长度字段写入ByteBuf中，最后将要发送的ByteBuf复制到List<object>out中，完成编码；否则抛出IllegalArgumentException异常。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf msg, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> length = msg.readableBytes() + lengthAdjustment;</span><br><span class="line">    <span class="keyword">if</span> (lengthIncludesLengthFieldLength) &#123;</span><br><span class="line">        length += lengthFieldLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                <span class="string">"Adjusted frame length ("</span> + length + <span class="string">") is less than zero"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (lengthFieldLength) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= <span class="number">256</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"length does not fit into a byte: "</span> + length);</span><br><span class="line">        &#125;</span><br><span class="line">        out.add(ctx.alloc().buffer(<span class="number">1</span>).order(byteOrder).writeByte((<span class="keyword">byte</span>) length));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= <span class="number">65536</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"length does not fit into a short integer: "</span> + length);</span><br><span class="line">        &#125;</span><br><span class="line">        out.add(ctx.alloc().buffer(<span class="number">2</span>).order(byteOrder).writeShort((<span class="keyword">short</span>) length));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= <span class="number">16777216</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"length does not fit into a medium integer: "</span> + length);</span><br><span class="line">        &#125;</span><br><span class="line">        out.add(ctx.alloc().buffer(<span class="number">3</span>).order(byteOrder).writeMedium(length));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        out.add(ctx.alloc().buffer(<span class="number">4</span>).order(byteOrder).writeInt(length));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        out.add(ctx.alloc().buffer(<span class="number">8</span>).order(byteOrder).writeLong(length));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"should not reach here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    out.add(msg.retain());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></object></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/05/07/Netty源码分析之编码与解码/#post-footer" class="postShorten-excerpt_link link">
                                COMMENT AND SHARE
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/page/28/">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>NEWER</span>
            </a>
        </li>
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/page/30/">
                    <span>OLDER</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">PAGE 29 OF 47</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 冼毅俊. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar_01.jpg"/>
        
            <h4 id="about-card-name">冼毅俊</h4>
        
            <h5 id="about-card-bio"><p>Xupter√Java√德桌迷√虐心控√mugen爱好者√音乐杂食党√小说发烧友√基本色√鱼迷√stan√bitch√daydreamer</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Java研发</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                长安
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/background-4.png');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/jquery.fancybox-thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->
<!--PANGU AUTO SPACE-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/3.2.1/pangu.min.js"></script>
<script> pangu.spacingPage(); </script>
<!--PANGU AUTO SPACE END-->



</html>
